# OpenRouter konektovanje

U ovoj lekciji istražit ćemo [**OpenRouter.ai**](http://OpenRouter.ai), platformu koja služi kao posrednik (*provider*) i omogućava nam da putem jednog, jedinstvenog API-ja pristupimo stotinama različitih AI modela od raznih kompanija (Google, OpenAI, Mistral, Anthropic, itd.). Naučit ćemo kako da se povežemo, kako da dinamički učitavamo listu dostupnih besplatnih modela i kako da ih testiramo unutar naše Streamlit aplikacije.

## 1. Šta je OpenRouter i zašto ga koristiti?

![image.png](/files/images/06_image.png)

**1. Šta je OpenRouter?**

- To je servis koji objedinjuje API-je mnogih AI provajdera na jednom mjestu.
- **Ključna prednost:** Koristi **OpenAI-kompatibilan API**. To znači da možemo koristiti zvaničnu `openai` Python biblioteku za komunikaciju sa svim modelima na OpenRouteru, bilo da se radi o Llama, Mixtral, Qwen ili nekom drugom modelu. Ovo drastično pojednostavljuje kodiranje.

```python
from openai import OpenAI

client = OpenAI(
  base_url="https://openrouter.ai/api/v1",
  api_key="<OPENROUTER_API_KEY>",
)

completion = client.chat.completions.create(
  extra_body={},
  model="openai/gpt-5",
  messages=[
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "What is in this image?"
        },
        {
          "type": "image_url",
          "image_url": {
            "url": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Gfp-wisconsin-madison-the-nature-boardwalk.jpg/2560px-Gfp-wisconsin-madison-the-nature-boardwalk.jpg"
          }
        }
      ]
    }
  ]
)
print(completion.choices[0].message.content)
```

**2. Prednosti za nas:**

![image.png](/files/images/06_image%201.png)

- **Pristup besplatnim modelima:** OpenRouter nudi impresivnu listu modela koji se mogu koristiti potpuno besplatno, što je idealno za učenje i eksperimentisanje. [https://openrouter.ai/models?max_price=0](https://openrouter.ai/models?max_price=0)
- **Jednostavno testiranje:** Lako možemo prebacivati između različitih modela promjenom samo jedne linije koda, što nam omogućava da uporedimo njihove performanse.
- **Plaćanje po potrošnji (Pay-as-you-go):** Za napredne modele, plaćate samo onoliko koliko tokena potrošite, bez mjesečnih pretplata.

## 2. Kreiranje naloga i dobijanje API ključa

![image.png](/files/images/06_image%202.png)

**1. Registracija i dobijanje API ključa:**

- Idite na [**OpenRouter.ai**](https://openrouter.ai/) i kreirajte nalog.
- Nakon prijave, idite na svoj nalog (klikom na ikonicu u gornjem desnom uglu) i odaberite **"Keys"**.
- Kliknite na **"Create Key"**, dajte ključu ime (npr. `test-chatbot`) i kreirajte ga.
- **VAŽNO:** Odmah kopirajte generisani API ključ. Kada zatvorite prozor, više ga nećete moći vidjeti. **Čuvajte ovaj ključ kao lozinku!**

**2. Sigurnost API ključa:**

- **Nikada ne upisujte API ključ direktno u kod (`api_key = "sk-or-..."`)!** Ako takav kod objavite na GitHubu, botovi ga mogu pronaći u roku od nekoliko minuta i zloupotrijebiti vaš nalog.
- Koristit ćemo sigurne metode, kao što je Streamlit-ov sistem za tajne (`secrets.toml`) ili `.env` fajlove.

## 3. Povezivanje i kreiranje Chatbota

Sada ćemo našu aplikaciju povezati sa OpenRouter-om.

**1. Instalacija potrebne biblioteke:**

- Moramo instalirati zvaničnu OpenAI biblioteku. Otvorite terminal u svom projektu i pokrenite:
    
    ```bash
    uv pip install openai
    ```
    

**2. Kreiranje osnovnog Chatbota uz pomoć AI-ja:**

- Koristit ćemo Gemini/Qwen da nam brzo generiše početnu strukturu.
- U terminalu zadajte komandu:
    
    ```
    Create a chatbot interface using Streamlit. The chatbot should connect to the OpenRouter API. Use the 'openai' Python library.
    
    ```
    
- AI će generisati `app.py` fajl sa osnovnom logikom.

**3. Konfiguracija konekcije u kodu (`app.py`):**

- Unutar koda, pronađite dio gdje se kreira OpenAI klijent. Ključne su dvije postavke:
    - **`base_url`:** Mora biti adresa OpenRouter servera.
        
        ```python
        base_url="<https://openrouter.ai/api/v1>"
        ```
        
    - **`api_key`:** Ovdje ćemo sigurno učitati naš ključ. AI će vjerovatno generisati kod koji koristi Streamlit-ov `st.secrets`:
        
        ```python
        api_key=st.secrets["OPENROUTER_API_KEY"]
        ```
        
- Da bi ovo radilo, u folderu vašeg projekta napravite podfolder `.streamlit` i unutar njega fajl `secrets.toml`. U taj fajl unesite:
    
    ```toml
    OPENROUTER_API_KEY = "ovdje-zalijepite-svoj-kljuc"
    ```
    

## 4. Dinamičko učitavanje besplatnih modela

Ne želimo ručno unositi imena modela. Napravit ćemo funkciju koja će sama povući listu svih besplatnih modela sa OpenRoutera.

**1. Otkrivanje API Endpointa za listu modela:**

- OpenRouter dokumentacija (ili upit AI asistentu) otkriva da se lista svih modela može dobiti slanjem GET zahtjeva na adresu: `https://openrouter.ai/api/v1/models`.

**2. Pisanje funkcije za dobijanje modela:**

- Napravit ćemo Python funkciju `get_free_models()` koja radi sljedeće:
    1. Uvozi `requests` biblioteku (`uv pip install requests`).
    2. Šalje GET zahtjev na gore navedenu adresu.
    3. Pretvara odgovor iz JSON formata u Python listu.
    4. Filtrira listu i vraća samo one modele kod kojih je cijena (`pricing['prompt']`) jednaka nuli.
    5. Vraća listu ID-jeva tih modela.
- **Primjer funkcije:**
    
    ```python
    import requests
    
    def get_free_models():
        response = requests.get("<https://openrouter.ai/api/v1/models>")
        if response.status_code == 200:
            models_data = response.json()
            # Filtriramo samo modele gdje je cijena prompta 0
            free_models = [
                model['id'] for model in models_data['data']
                if model.get('pricing', {}).get('prompt') == '0.0'
            ]
            return free_models
        else:
            return []
    ```
    

**3. Integracija u Streamlit interfejs:**

- U glavnom dijelu `app.py`, pozvat ćemo ovu funkciju i rezultat prikazati u `st.selectbox`u, omogućavajući korisniku da izabere model iz padajućeg menija.
    
    ```python
    # ... unutar glavnog dijela koda ...
    available_models = get_free_models()
    selected_model = st.sidebar.selectbox("Odaberite besplatni model:", available_models)
    ```
    
- Vrijednost `selected_model` ćemo zatim koristiti prilikom slanja zahtjeva AI-ju.

## Zaključak

Uspješno smo povezali našu aplikaciju na OpenRouter, čime smo dobili pristup stotinama modela kroz jedan, čist interfejs. Naučili smo kako sigurno upravljati API ključevima i kako dinamički učitavati podatke sa eksternog API-ja kako bismo našu aplikaciju učinili fleksibilnom i moćnom.