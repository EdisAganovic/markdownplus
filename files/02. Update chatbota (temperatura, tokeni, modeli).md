# Update chatbota (temperatura, tokeni, modeli)

U ovoj lekciji, nadogradit ćemo našeg Gemini chatbota kojeg smo napravili prošli put. Naučit ćemo kako da mijenjamo AI modele, dodajemo nove funkcije u interfejs pomoću Gemini CLI, te ćemo razumjeti ključne koncepte kao što su **temperatura** i **tokeni**.

## 1. Analiza i priprema projekta

**Pokrenite aplikaciju i pripremite terminal:**

- Unutar VS Code-a, otvorite novi terminal (Terminal -> New Terminal).
- Aktivirajte virtuelno okruženje: code Powershell
    
    ```
    .venv\Scripts\activate
    ```
    
- Pokrenite aplikaciju putem komande:
    
    ```
    streamlit run app.py
    ```
    
    Vaš chatbot će se otvoriti u web-pregledniku. Ostavite ga otvorenog.
    
- U VS Code-u, kliknite na **split terminal** ikonicu (podijeli terminal) kako biste dobili drugi terminal pored postojećeg. U ovom drugom terminalu ćemo koristiti Gemini CLI za kodiranje.
- I u drugom terminalu aktivirajte virtuelno okruženje.

## 2. Ispravka instalacije Visual Studio Code (ako je potrebno)

![image.png](/files/images/02_image.png)

- Ako ste primjetili da vam nedostaje opcija *„Open with Code“* kada kliknemo desnim klikom na folder. Ako i vi imate taj problem, najlakše rješenje je ponovo instalirati VS Code sa [zvanične stranice](https://www.google.com/url?sa=E&q=https%3A%2F%2Fcode.visualstudio.com%2Fdownload).

![image.png](/files/images/02_image%201.png)

- Tokom instalacije, **obavezno označite** opcije za dodavanje *„Open with Code“* u kontekstualni meni.

## 3. Analiza projekta

Desni klik na folder vašeg projekta (MojGeminiChatbot) i odaberite **Open with Code**.

U VS Code-u, sada imamo slijedeću strukturu fajlova:

![image.png](/files/images/02_image%202.png)

- **app.py**: Glavni kod naše aplikacije.
- **requirements.txt:** Spisak Python paketa potrebnih za rad aplikacije.
- **.venv**: Folder koji sadrži naše virtuelno okruženje. **Ovaj folder može postati prilično velik (nekoliko stotina megabajta)**, jer se u njemu čuvaju svi instalirani paketi.

### Razumijevanje postojećeg koda u app.py

- **Uvoz biblioteka:**
    
    ```python
    import streamlit as st
    ```
    
    Uvozimo Streamlit biblioteku (za kreiranje web interfejsa) i dajemo joj kraći naziv st.
    
    ```python
    import google.generativeai as genai
    ```
    
    Uvozimo Google-ovu biblioteku za rad sa AI modelima.
    
    ```python
    import os
    ```
    
    Koristimo za pristup sistemskim varijablama, konkretno za čitanje našeg API ključa.
    
- **Konfiguracija:**
    
    ```python
    api_key = os.environ.get("GEMINI_API_KEY")
    
    if api_key:
        genai.configure(api_key=api_key)
    else:
        st.error("Gemini API key not found. Please set the GEMINI_API_KEY environment variable.")
        st.stop()
    ```
    
    - Kod provjerava da li postoji GEMINI_API_KEY i koristi ga za konfiguraciju. Ako ključ ne postoji, aplikacija se zaustavlja.
- **Odabir modela:**
    
    ```python
    model = genai.GenerativeModel('gemini-2.0-flash') 
    ```
    
    - definiše koji AI model želimo koristiti.
- **Logika aplikacije:**
    
    ```python
    # Initialize chat history
    if "messages" not in st.session_state:
        st.session_state.messages = []
    
    # Streamlit app title
    st.title("Edis Chatbot")
    
    # Display chat messages from history on app rerun
    for message in st.session_state.messages:
        with st.chat_message(message["role"]):
            st.markdown(message["content"])
    
    # React to user input
    if prompt := st.chat_input("Sha ima?"):
        # Display user message in chat message container
        with st.chat_message("user"):
            st.markdown(prompt)
        # Add user message to chat history
        st.session_state.messages.append({"role": "user", "content": prompt})
    
        # Get response from Gemini
        response = model.generate_content(prompt)
        response_text = response.text
        
        # Display assistant response in chat message container
        
        with st.chate_message("assistant"):
    		    st.markdown(response.text)
    		    
    		# Add assistant response to chat history
    		st.session_sate.messages.append({"role":"assistant,"content":response_text})
    	    
    ```
    
    - Kod ispisuje naslov i poruke na ekranu, čuva historiju razgovora (samo dok je aplikacija pokrenuta) i šalje korisnikov upit (prompt) Gemini API-ju.

## 4. Promjena AI modela za bolje performanse

![image.png](/files/images/02_image%203.png)

Google vam nudi svoje besplatne modele Gemma o kojima možete više informacija pronaći u **Google AI Studio**. Postoje verzije sa 1, 2, 4, 12, pa čak i 27 milijardi parametara.

Odabrat ćemo jači model Gemma 3 27b. U fajlu app.py, pronađite liniju:

```python
model = genai.GenerativeModel('gemini-2.0-flash')
```

I zamijenite je sa:

```python
model = genai.GenerativeModel('gemma-3-27b-it') 
```

Sačuvajte fajl. 

![image.png](/files/images/02_image%204.png)

- Ne zaboravite uključiti opciju AutoSave u Visual Studio code putem File menija.
- Nakon što uključite automatsko spašavanje, dovoljno je samo da odradite Refresh u browseru, nema potrebe da zaustavljate aplikaciju i opet je pokrećete.

## 5. Dodavanje "Dark Mode" u chat interfejsu i opcije za kopiranje odgovora:

U drugom terminalu (gdje nije aktivna aplikacija), pokrenite Gemini CLI: 

```
gemini
```

Sada mu dajte zadatak na engleskom jeziku da unaprijedi kod:

```
add option to copy response message and make chat in dark theme
```

Gemini CLI će analizirati **app.py** i automatski ga izmijeniti kako bi dodao ove funkcije. 

Provjerite aplikaciju u pregledniku – sada bi trebala imati tamnu temu i dugme za kopiranje pored svakog AI odgovora.

## 6. Dodavanje kontrole za "Temperaturu"

![image.png](/files/images/02_image%205.png)

**Šta je Temperatura?** To je postavka koja kontroliše "kreativnost" AI modela.

- **Temperatura 0.0:** Model će biti vrlo precizan, doslovan i davat će najvjerovatniji odgovor. Dobro za činjenice i kod.
- **Temperatura 1.0 (ili više):** Model će biti vrlo kreativan, pa čak i nasumičan. Dobro za pisanje priča ili generisanje ideja.
- **Default vrijednost** je obično između 0.5 i 0.7.

Dajte Gemini CLI-ju novi zadatak: 

```
add setting for temperature in streamlit in my sidebar
```

Gemini će dodati klizač (*slider*) u bočnu traku (*sidebar*) vaše aplikacije. Sada možete dinamički mijenjati temperaturu i odmah vidjeti kako to utiče na odgovore.

```python
temperature = st.sidebar("Temperature": 0.00, 1.0, 0.5, 0.1)
# 0.0 = min vrijednost
# 1.0 = max vrijednost
# 0.5 = defaultna vrijednost
# 0.1 = iznos povećavanja kada slider pomjerate
```

Svaki model ima svoja podešavanja i maksimalnu temperaturu. Npr. Gemma je max. 1 a Gemini ide do 2.

## 7. Prikaz broja tokena (ulaznih, izlaznih)

**Šta su Tokeni?** AI ne čita tekst kao slova ili riječi, već ga razbija na dijelove koji se zovu "tokeni". Jedan token može biti riječ, dio riječi, ili znak interpunkcije. Brojanje tokena je važno jer modeli imaju ograničenje koliko tokena mogu obraditi, a napredni modeli često naplaćuju po broju tokena.

**Očistite memoriju Gemini CLI-ja (ako je potrebno):** Ponekad se AI "zbuni”. Da biste ga natjerali da ponovo pročita vaše fajlove, koristite komandu /clear u Gemini CLI.

![image.png](/files/images/02_image%206.png)

Dajte mu zadnji zadatak za ovu lekciju:

```
display number of input and output tokens for each prompt
```

Nakon što Gemini završi, vaša aplikacija će ispod svakog odgovora ispisivati koliko je tokena bilo u vašem pitanju (input) i koliko u odgovoru modela (output).

![image.png](/files/images/02_image%207.png)

Način implementacije naših promptova će biti različit jer mu nismo dali specifičan način kako želimo nešto odraditi:

- Dugme Copy će biti implementirano na više načina
- Dizajn interfejsa će biti drugačiji
- Prikaz ulaznih i izlaznih tokena će implementiran na više načina (nekad u Sidebaru, nekad odmah kod našeg prompta i kod odgovora)

---

**Čestitamo!** Uspješno ste nadogradili svoju AI aplikaciju, naučili je kontrolisati pomoću naprednih postavki i razumjeli ste osnovne koncepte na kojima se zasnivaju jezički modeli. Sada nastavite dalje da eksperimentišete.